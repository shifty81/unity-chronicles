# TileTemplate Error - Complete Solution Guide

## The Problem

When opening this Unity 6 LTS project, you may encounter these compilation errors:

```
Library\PackageCache\com.unity.2d.tilemap.extras@[hash]\Editor\Tiles\AutoTile\AutoTileTemplate.cs(12,37): 
error CS0246: The type or namespace name 'TileTemplate' could not be found

Library\PackageCache\com.unity.2d.tilemap.extras@[hash]\Editor\Tiles\RuleTile\RuleTileTemplate.cs(13,37): 
error CS0246: The type or namespace name 'TileTemplate' could not be found
```

## Why This Happens

Unity 6 LTS requires version **6.0.1** of the `com.unity.2d.tilemap.extras` package, which removed the deprecated `TileTemplate` class. However, Unity may be using **cached files from an older version** (4.x or 5.x) that still references this class.

Even though the project's `manifest.json` and `packages-lock.json` specify version 6.0.1, Unity has multiple cache locations that can serve stale packages:

1. **Project cache**: `Library/PackageCache/` (specific to this project)
2. **System-wide cache**: OS-specific location (shared across all Unity projects)
   - Windows: `%LOCALAPPDATA%\Unity\cache`
   - macOS: `~/Library/Unity/cache`
   - Linux: `~/.config/unity3d/cache`

The standard "delete Library folder" fix only clears #1, which is why errors sometimes persist.

## The Solution

### Step 1: Diagnose (Recommended)

First, verify what's actually wrong:

```bash
# Windows PowerShell
.\verify-packages.ps1

# macOS/Linux
./verify-packages.sh
```

This script will:
- ✅ Check your Unity version
- ✅ Verify package versions in manifest and lock file
- ✅ Scan cached packages for TileTemplate references
- ✅ Tell you exactly what's wrong and how to fix it

### Step 2: Fix - Standard Cleanup

If Step 1 found issues, start with the standard cleanup:

```bash
# Windows PowerShell
.\cleanup-unity-cache.ps1

# macOS/Linux
./cleanup-unity-cache.sh
```

**Before running:**
- Close Unity Editor completely
- Save your work

**What it does:**
- Removes `Library/PackageCache/` (project-level cache)
- Removes `Packages/packages-lock.json`
- Or removes entire `Library/` folder (you choose)

**After running:**
- Open project through Unity Hub
- Wait 2-5 minutes for Unity to reimport assets
- Check Console for errors

### Step 3: Fix - Advanced Cleanup (If Standard Didn't Work)

**Still getting errors?** Use the advanced cleanup:

```bash
# Windows PowerShell
.\advanced-cleanup.ps1

# macOS/Linux
./advanced-cleanup.sh
```

**Before running:**
- Close Unity Editor completely
- **ALSO close Unity Hub** (important!)
- Save your work

**What it does (more aggressive):**
- Removes entire `Library/` folder
- Removes `Packages/packages-lock.json`
- Removes `Temp/` folder
- **Removes system-wide Unity package cache** ⭐ This is the key difference!

**After running:**
- Open Unity Hub
- Open project through Unity Hub
- Wait 5-10 minutes for Unity to:
  - Regenerate Library folder
  - Download packages from Unity Registry
  - Reimport all assets
- Check Console - errors should be gone

### Why Advanced Cleanup Works

The advanced cleanup clears **system-wide Unity caches** that persist even after deleting the project's Library folder. This is the most common cause of persistent TileTemplate errors.

Unity will automatically regenerate all deleted caches from:
- Your project's `manifest.json` (specifies package versions)
- Unity Package Registry (downloads correct versions)
- Your Assets folder (source of truth)

Nothing is permanently lost - everything is rebuilt correctly.

## Quick Reference

| Symptom | Solution |
|---------|----------|
| First time seeing error | Run `cleanup-unity-cache` |
| Error persists after cleanup | Run `advanced-cleanup` |
| Want to check what's wrong | Run `verify-packages` |
| Error after Unity/package update | Run `cleanup-unity-cache` |
| Multiple projects affected | Run `advanced-cleanup` (clears shared cache) |

## Still Having Issues?

If errors persist even after advanced cleanup:

1. **Verify Unity version**: Ensure you're using Unity 6 LTS (6000.0.x)
2. **Update Unity Hub**: Old Hub versions can cache incorrectly
3. **Check Unity Registry access**: Ensure you can reach `packages.unity.com`
4. **Try Unity safe mode**: Open with specific rendering (Windows: `Unity.exe -force-d3d11`)
5. **Nuclear option**: See TROUBLESHOOTING.md section "Last resort"

## What Files Are Safe to Delete?

✅ **Safe to delete (regenerated by Unity):**
- `Library/` folder
- `Temp/` folder
- `Packages/packages-lock.json`
- `obj/` folder (if exists)
- System-wide Unity caches

❌ **NEVER delete:**
- `Assets/` folder
- `ProjectSettings/` folder
- `Packages/manifest.json`
- Your C# scripts
- Your scenes

## Understanding the Scripts

### verify-packages
- **Purpose**: Read-only diagnostics
- **Safe**: Yes - makes no changes
- **When**: Before cleanup, or to check if problem is fixed
- **Time**: Instant

### cleanup-unity-cache
- **Purpose**: Standard cache cleanup
- **Safe**: Yes - removes only regenerable caches
- **When**: First attempt at fixing errors
- **Time**: Instant script, 2-5 min Unity reimport

### advanced-cleanup
- **Purpose**: Aggressive cleanup including global caches
- **Safe**: Yes - all removed files are regenerated
- **When**: Standard cleanup didn't fix the problem
- **Time**: Instant script, 5-10 min Unity reimport

## Prevention

To avoid this problem in the future:

1. **Always use Unity Hub** to open projects
2. **Keep Unity 6 LTS updated** to latest patch version
3. **Close Unity completely** when running cleanup scripts
4. **Close Unity Hub too** when running advanced cleanup
5. **Don't manually edit** `Library/PackageCache/`
6. **After package updates**, close and reopen Unity

## More Help

- **Quick fixes**: See [QUICK_FIX.md](QUICK_FIX.md)
- **All cleanup tools**: See [CLEANUP_TOOLS.md](CLEANUP_TOOLS.md)
- **Detailed troubleshooting**: See [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
- **Package history**: See [PACKAGE_UPDATE_NOTES.md](PACKAGE_UPDATE_NOTES.md)

## Technical Deep Dive

For those interested in the technical details:

**Unity Package Resolution:**
1. Unity reads `Packages/manifest.json` for package dependencies
2. Checks `Packages/packages-lock.json` for locked versions
3. Looks in project cache: `Library/PackageCache/`
4. If not found, looks in system cache: `%LOCALAPPDATA%\Unity\cache` (Windows)
5. If not found, downloads from `packages.unity.com`

**The Bug:**
When Unity upgraded from 2021/2022 to Unity 6, the tilemap.extras package changed from 4.x/5.x to 6.x. However, Unity's cache resolution sometimes uses #3 or #4 even when the manifest specifies a different version, especially if the package was previously cached.

**The Fix:**
Clearing both project-level (#3) and system-level (#4) caches forces Unity to re-download the correct version (#5) specified in the manifest.

---

**Last Updated**: November 2025  
**Unity Version**: 6 LTS (6000.0.62f1)  
**Package Version**: com.unity.2d.tilemap.extras@6.0.1
